"use strict";(()=>{var e={};e.id=971,e.ids=[971],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5158:e=>{e.exports=require("http2")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},7282:e=>{e.exports=require("process")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},4553:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>E,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>l,staticGenerationAsyncStorage:()=>_});var s={};t.r(s),t.d(s,{GET:()=>p});var a=t(9303),o=t(8716),n=t(670),i=t(7070),c=t(3820),u=t(2188);async function p(e){try{let r=new URL(e.url),t=r.searchParams.get("code"),s=r.searchParams.get("state");if(!t||!s)return i.NextResponse.json({error:"Missing code or state"},{status:400});let a=process.env.FACEBOOK_APP_ID,o=process.env.FACEBOOK_APP_SECRET,n=`${r.origin}/api/instagram/oauth/callback`,p=await fetch(`https://graph.facebook.com/v21.0/oauth/access_token?client_id=${a}&redirect_uri=${encodeURIComponent(n)}&client_secret=${o}&code=${t}`),d=await p.json();if(d.error)return i.NextResponse.json({error:d.error.message},{status:500});let m=d.access_token,_=await fetch(`https://graph.facebook.com/v21.0/me/accounts?access_token=${m}&fields=id,name,access_token,instagram_business_account`),l=await _.json(),g=l.data?.find(e=>e.instagram_business_account);if(!g)return i.NextResponse.json({error:"No Instagram business page found"},{status:404});let E=g.access_token,h=g.instagram_business_account.id,I=await fetch(`https://graph.facebook.com/v21.0/${h}?fields=username&access_token=${E}`),x=await I.json();return await (0,c.r7)((0,c.JU)(u.db,"bots",s),{instagramConnected:!0,instagramUsername:x.username,instagramBusinessId:h,instagramPageId:g.id,instagramAccessToken:E,connectedAt:new Date().toISOString()}),i.NextResponse.redirect(`${r.origin}/?success=true`)}catch(e){return i.NextResponse.json({error:e.message},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/instagram/oauth/callback/route",pathname:"/api/instagram/oauth/callback",filename:"route",bundlePath:"app/api/instagram/oauth/callback/route"},resolvedPagePath:"C:\\Users\\Abdulla Alshameeri\\Documents\\GitHub\\Mokai-AI\\app\\api\\instagram\\oauth\\callback\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:l}=d,g="/api/instagram/oauth/callback/route";function E(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:_})}},2188:(e,r,t)=>{t.d(r,{db:()=>i});var s=t(9362),a=t(3820);let o={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyCQCT7jSJQYJYBhFIVapgpBQOhenUDs3K4",authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"mokai-bot.firebaseapp.com",projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"mokai-bot",storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"mokai-bot.firebasestorage.app",messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"28722487944",appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:28722487944:web:0183b2afc0ef7d021e753d",measurementId:process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-MC2P6DLV9N"},n=(0,s.C6)().length?(0,s.Mq)():(0,s.ZF)(o),i=(0,a.ad)(n)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,999],()=>t(4553));module.exports=s})();