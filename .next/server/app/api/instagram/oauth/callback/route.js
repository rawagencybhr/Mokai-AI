"use strict";(()=>{var e={};e.id=971,e.ids=[971],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5158:e=>{e.exports=require("http2")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},7282:e=>{e.exports=require("process")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},5721:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>_,routeModule:()=>d,serverHooks:()=>l,staticGenerationAsyncStorage:()=>m});var a={};s.r(a),s.d(a,{GET:()=>p});var r=s(9303),o=s(8716),n=s(670),i=s(7070),c=s(3820),u=s(2188);async function p(e){let{searchParams:t,origin:s}=new URL(e.url),a=t.get("code"),r=t.get("state");if(!a||!r)return new i.NextResponse("Missing code or state",{status:400});try{let e=process.env.FACEBOOK_APP_ID,t=process.env.FACEBOOK_APP_SECRET,o=`${s}/api/instagram/oauth/callback`,n=`https://graph.facebook.com/v21.0/oauth/access_token?client_id=${e}&redirect_uri=${o}&client_secret=${t}&code=${a}`,p=await fetch(n),d=await p.json();if(d.error)return new i.NextResponse(`Error exchanging token: ${d.error.message}`,{status:500});let _=d.access_token,m=d.user_id;if(!m){let e=await fetch(`https://graph.facebook.com/me?access_token=${_}`);m=(await e.json()).id}let l=`https://graph.facebook.com/v21.0/me/accounts?access_token=${_}&fields=id,name,access_token,instagram_business_account`,g=await fetch(l),h=await g.json();if(!h.data||0===h.data.length)return new i.NextResponse("No pages found",{status:404});let E=h.data.find(e=>e.instagram_business_account);if(!E)return new i.NextResponse("No Instagram Business Account connected",{status:404});let I=`https://graph.facebook.com/v21.0/${E.instagram_business_account.id}?fields=username&access_token=${E.access_token}`,x=await fetch(I),b=await x.json(),A=(0,c.JU)(u.db,"bots",r);return await (0,c.r7)(A,{instagramConnected:!0,instagramAccessToken:E.access_token,instagramBusinessId:E.instagram_business_account.id,instagramUserId:m,instagramPageId:E.id,instagramUsername:b.username,connectedAt:new Date().toISOString()}),i.NextResponse.redirect(`${s}/dashboard?success=true`)}catch(e){return new i.NextResponse(`Internal Error: ${e.message}`,{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/instagram/oauth/callback/route",pathname:"/api/instagram/oauth/callback",filename:"route",bundlePath:"app/api/instagram/oauth/callback/route"},resolvedPagePath:"C:\\Users\\Abdulla Alshameeri\\Documents\\GitHub\\Mokai-AI\\app\\api\\instagram\\oauth\\callback\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:m,serverHooks:l}=d,g="/api/instagram/oauth/callback/route";function h(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:m})}},2188:(e,t,s)=>{s.d(t,{db:()=>i});var a=s(9362),r=s(3820);let o={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyCQCT7jSJQYJYBhFIVapgpBQOhenUDs3K4",authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"mokai-bot.firebaseapp.com",projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"mokai-bot",storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"mokai-bot.firebasestorage.app",messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"28722487944",appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:28722487944:web:0183b2afc0ef7d021e753d",measurementId:process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-MC2P6DLV9N"},n=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)(o),i=(0,r.ad)(n)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,972,999],()=>s(5721));module.exports=a})();