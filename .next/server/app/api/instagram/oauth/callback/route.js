"use strict";(()=>{var e={};e.id=971,e.ids=[971],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5158:e=>{e.exports=require("http2")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},7282:e=>{e.exports=require("process")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},4553:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>_,staticGenerationAsyncStorage:()=>l});var r={};s.r(r),s.d(r,{GET:()=>p});var a=s(9303),o=s(8716),n=s(670),i=s(7070),c=s(3820),u=s(2188);async function p(e){try{let t=new URL(e.url),s=t.searchParams.get("code"),r=t.searchParams.get("state");if(!s||!r)return i.NextResponse.json({error:"Missing code or state"},{status:400});let a=process.env.FACEBOOK_APP_ID,o=process.env.FACEBOOK_APP_SECRET,n=await fetch(`https://graph.facebook.com/v21.0/oauth/access_token?client_id=${a}&client_secret=${o}&redirect_uri=${encodeURIComponent("https://mokai-ai.vercel.app/api/instagram/oauth/callback")}&code=${s}`),p=await n.json();if(!p.access_token)return i.NextResponse.json({error:"Failed to exchange code for access token",details:p},{status:500});let d=p.access_token,m=await fetch(`https://graph.facebook.com/v21.0/me/accounts?fields=id,name,access_token,instagram_business_account&access_token=${d}`),l=await m.json();if(!l.data||0===l.data.length)return i.NextResponse.json({error:"No pages available"},{status:404});let _=l.data.find(e=>e.instagram_business_account);if(!_)return i.NextResponse.json({error:"No Instagram business page found"},{status:404});let g=_.access_token,h=_.instagram_business_account.id,E=await fetch(`https://graph.facebook.com/v21.0/${h}?fields=username&access_token=${g}`),I=await E.json();if(!I.username)return i.NextResponse.json({error:"Could not fetch Instagram username",details:I},{status:500});return await (0,c.r7)((0,c.JU)(u.db,"bots",r),{instagramConnected:!0,instagramUsername:I.username,instagramBusinessId:h,instagramPageId:_.id,instagramAccessToken:g,connectedAt:new Date().toISOString()}),i.NextResponse.redirect(`${t.origin}/?success=true`)}catch(e){return i.NextResponse.json({error:e.message},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/instagram/oauth/callback/route",pathname:"/api/instagram/oauth/callback",filename:"route",bundlePath:"app/api/instagram/oauth/callback/route"},resolvedPagePath:"C:\\Users\\Abdulla Alshameeri\\Documents\\GitHub\\Mokai-AI\\app\\api\\instagram\\oauth\\callback\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:l,serverHooks:_}=d,g="/api/instagram/oauth/callback/route";function h(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:l})}},2188:(e,t,s)=>{s.d(t,{db:()=>i});var r=s(9362),a=s(3820);let o={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyCQCT7jSJQYJYBhFIVapgpBQOhenUDs3K4",authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"mokai-bot.firebaseapp.com",projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"mokai-bot",storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"mokai-bot.firebasestorage.app",messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"28722487944",appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:28722487944:web:0183b2afc0ef7d021e753d",measurementId:process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-MC2P6DLV9N"},n=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)(o),i=(0,a.ad)(n)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972,999],()=>s(4553));module.exports=r})();