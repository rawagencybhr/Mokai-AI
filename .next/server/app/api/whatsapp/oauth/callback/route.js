"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5158:e=>{e.exports=require("http2")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},7282:e=>{e.exports=require("process")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},1925:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>E,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>_,staticGenerationAsyncStorage:()=>l});var r={};a.r(r),a.d(r,{GET:()=>u});var s=a(9303),o=a(8716),p=a(670),n=a(7070),i=a(3820),c=a(2188);async function u(e){let{searchParams:t,origin:a}=new URL(e.url),r=t.get("code"),s=t.get("state");if(!r||!s)return new n.NextResponse("Missing code or state",{status:400});try{let e=process.env.FACEBOOK_APP_ID,t=process.env.FACEBOOK_APP_SECRET,o=`${a}/api/whatsapp/oauth/callback`,p=`https://graph.facebook.com/v21.0/oauth/access_token?client_id=${e}&redirect_uri=${o}&client_secret=${t}&code=${r}`,u=await fetch(p),d=await u.json();if(d.error)return new n.NextResponse(`Error exchanging token: ${d.error.message}`,{status:500});let h=d.access_token,l=`https://graph.facebook.com/v21.0/me/businesses?access_token=${h}`,_=await fetch(l),E=await _.json(),b=null,m=null,I=null;if(E.data&&E.data.length>0)for(let e of E.data){let t=`https://graph.facebook.com/v21.0/${e.id}/client_whatsapp_business_accounts?access_token=${h}`,a=await fetch(t),r=await a.json();if(r.data&&r.data.length>0){b=r.data[0].id;break}}if(b){let e=`https://graph.facebook.com/v21.0/${b}/phone_numbers?access_token=${h}`,t=await fetch(e),a=await t.json();a.data&&a.data.length>0&&(m=a.data[0].id,I=a.data[0].display_phone_number)}if(!m)return new n.NextResponse("Could not find a WhatsApp Phone Number connected to your account.",{status:404});let x=(0,i.JU)(c.db,"bots",s);return await (0,i.r7)(x,{whatsappConnected:!0,whatsappAccessToken:h,whatsappBusinessAccountId:b,whatsappPhoneNumberId:m,whatsappPhoneNumber:I}),n.NextResponse.redirect(`${a}/dashboard?success=true`)}catch(e){return new n.NextResponse(`Internal Error: ${e.message}`,{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/whatsapp/oauth/callback/route",pathname:"/api/whatsapp/oauth/callback",filename:"route",bundlePath:"app/api/whatsapp/oauth/callback/route"},resolvedPagePath:"C:\\Users\\Abdulla Alshameeri\\Documents\\GitHub\\Mokai-AI\\app\\api\\whatsapp\\oauth\\callback\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:l,serverHooks:_}=d,E="/api/whatsapp/oauth/callback/route";function b(){return(0,p.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:l})}},2188:(e,t,a)=>{a.d(t,{db:()=>n});var r=a(9362),s=a(3820);let o={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyCQCT7jSJQYJYBhFIVapgpBQOhenUDs3K4",authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"mokai-bot.firebaseapp.com",projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"mokai-bot",storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"mokai-bot.firebasestorage.app",messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"28722487944",appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:28722487944:web:0183b2afc0ef7d021e753d",measurementId:process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-MC2P6DLV9N"},p=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)(o),n=(0,s.ad)(p)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972,999],()=>a(1925));module.exports=r})();